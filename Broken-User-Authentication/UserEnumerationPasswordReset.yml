id: USER_ENUM_PASSWORD_RESET
info:
  name: "Broken Authentication Test - Username Enumeration on Password Reset Endpoint"
  description: > 
    "This test involves identifying security vulnerabilities by testing the 
    system's response to password reset requests with valid and invalid usernames, aiming 
    to uncover potential information disclosure risks"
  details: >
    "Broken Authentication Test - Username Enumeration on Password Reset Endpoint 
    is a security evaluation where testers probe a system by submitting password 
    reset requests with various usernames. The objective is to detect if the system 
    responds differently for valid and invalid usernames, potentially revealing 
    sensitive information. This testing helps organizations identify and 
    rectify vulnerabilities in their authentication mechanisms to prevent unauthorized access."
  impact: >
    "A successful Broken Authentication Test - Username Enumeration on Password Reset Endpoint 
    can lead to unauthorized access, as attackers exploit revealed valid usernames. This may 
    result in compromised user accounts, unauthorized data access, and potential privacy 
    breaches. Addressing such vulnerabilities is crucial to maintaining the integrity and 
    security of the system."

  category:
    name: NO_AUTH
    shortName: Broken Authentication
    displayName: Broken User Authentication (BUA)
  subCategory: USER_ENUM_PASSWORD_RESET
  severity: HIGH
  tags:
    - Business logic
    - OWASP top 10
    - HackerOne top 10
  references:
    - "https://owasp.org/www-project-web-security-testing-guide/v42/4-Web_Application_Security_Testing/"
    - "https://github.com/OWASP/API-Security/blob/master/2019/en/src/0xa2-broken-user-authentication.md"
    - "https://cheatsheetseries.owasp.org/cheatsheets/Authentication_Cheat_Sheet.html"
    - "https://cwe.mitre.org/data/definitions/798.html"
  cwe:
    - CWE-287
  cve:
    - CVE-2021-45901
    - CVE-2021-4191

api_selection_filters:
  response_code:
    gte: 200
  url:
    contains_either:
      - password-reset
      - reset-password
      - forgot-password
      - "user/reset"
      - "account/recover"
      - "api/password_reset"
      - "password/reset"
      - "reset"
      - "recover"
      - "password/forgot"
      - "reset/confirm"
      - "password/change"
      - "password/new"
      - "account/reset-password-request"
      - "help/login"
      - "new_password"
      - "password_reset_request"
      - "send_recovery_email"
      - "verify_email"
      - "unlock_account"
      - "account_recovery"
execute:
  type: multiple
  requests:
  - req:
    - modify_body_param:
        password: xyz
    - validate:
        response_code:
          gte: 400
  - req:
    - modify_body_param:
        email: xyz@abc.com
        password: dfk
    - validate:
        or:
          - response_code:
              neq: "${x1.response_code}"
          - response_payload:
              neq: "${x1.response}" # content matching