id: REMOVE_CSRF
info:
  name: "CSRF test by removing csrf token"
  description: "Assessing the system's vulnerability by removing the CSRF token to determine if unauthorized actions can be performed."
  details: >
            "Evaluating the effectiveness of the web application's CSRF protection mechanism by intentionally removing the CSRF token"
            "and assessing if unauthorized actions can be successfully executed, potentially exposing the system to security risks and breaches."
  impact: >
    "Successful execution of unauthorized actions due to the absence of CSRF token may result in severe consequences,"
    "such as unauthorized data modification, account hijacking, or sensitive information disclosure,"
    "highlighting critical vulnerabilities and emphasizing the need for robust CSRF protection measures."
  remediation: "To mitigate the risk of CSRF test by removing CSRF tokens, ensure that all sensitive actions in your application require a valid CSRF token. Implement strict validation on the server-side to reject requests without a valid CSRF token. Additionally, consider implementing double-submit cookies or other techniques to further protect against CSRF attacks. Regularly review and update your CSRF protection mechanisms to address any identified vulnerabilities."
  category:
    name: NO_AUTH
    shortName: Broken Authentication
    displayName: Broken User Authentication (BUA)
  subCategory: REMOVE_CSRF
  severity: HIGH
  tags:
    - Business logic
    - OWASP top 10
    - HackerOne top 10
  references:
    - "https://portswigger.net/web-security/csrf"
    - "https://owasp.org/www-community/attacks/csrf"
    - "https://github.com/OWASP/API-Security/blob/master/editions/2023/en/0xa2-broken-authentication.md"
  cwe:
    - CWE-352
  cve:
    - CVE-2023-41942
    - CVE-2022-26180

api_selection_filters:
  response_payload:
    length:
      gt: 0
    not_contains_either:
      - Error
      - Internal Server 
      - Failed
      - Unauthorized
      - access denied
      - Forbidden
      - Method Not allowed
      - Gateway timeout
      - request timeout
      - server error
      - server busy
      - authentication error
      - authorization error
      - validation error
      - Permission Denied
      - invalid token
      - token expired
      - session expired
      - session timeout
      - unexpected error
      - unable to process request
      - bad request
      - service unavailable
      - account is locked
      - account is blocked
      - multiple failed attempts
  and:
    - response_code:
        gte: 200
        lt: 300
    - or:
      - method:
          neq: GET
      - or:
          - request_payload:
              for_one:
                key:
                  regex: .*
          - query_param:
              for_one:
                key:
                  regex: .*
    - or:
      - request_headers:
          for_one:
            key:
              contains_either: csrf
              extract: csrf_key
      - request_payload:
          for_one:
            key:
              contains_either: csrf
              extract: csrf_key
      - query_param:
          for_one:
            key:
              contains_either: csrf
              extract: csrf_key

execute:
  type: single
  requests:
    - req:
        - delete_header: ${csrf_key}
        - delete_body_param: ${csrf_key}
        - delete_query_param: ${csrf_key}

validate:
  response_code:
    gte: 200
    lt: 300
  response_payload:
    percentage_match: 
      gt: 80
    length:
      gt: 0
    not_contains_either:
      - Error
      - Internal Server 
      - Failed
      - Unauthorized
      - access denied
      - Forbidden
      - Method Not allowed
      - Gateway timeout
      - request timeout
      - server error
      - server busy
      - authentication error
      - authorization error
      - validation error
      - Permission Denied
      - invalid token
      - token expired
      - session expired
      - session timeout
      - unexpected error
      - unable to process request
      - bad request
      - service unavailable
      - account is locked
      - account is blocked
      - multiple failed attempts