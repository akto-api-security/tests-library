id: SSRF_ON_LOCALHOST
info:
  name: "Sensitive localhost details exposed via replacing URI param with localhost/admin due to SSRF"
  description: "The endpoint appears to be vulnerable to Server Side Request Forgery attack. The original request was replayed by replacing the URI parameter with localhost/admin. The application responded with 2XX success code and also gave out admin-related details."
  details: >
    "The endpoint appears to be vulnerable to Server Side Request Forgery attack. The original request was replayed by replacing the URI parameter with localhost/admin. The application responded with 2XX success code and also gave out admin-related details.
    Modern concepts in application development make SSRF more common and more dangerous.
    More common - the following concepts encourage developers to access an external resource based on user input: Webhooks, file fetching from URLs, custom SSO, and URL previews.
    More dangerous - Modern technologies like cloud providers, Kubernetes, and Docker expose management and control channels over HTTP on predictable, well-known paths. Those channels are an easy target for an SSRF attack.
    It is also more challenging to limit outbound traffic from your application, because of the connected nature of modern applications.
    The SSRF risk can not always be completely eliminated. While choosing a protection mechanism, it is important to consider the business risks and needs."
  impact: "Successful exploitation can lead to access control bypass, sensitive data leak, or even compromise the application."
  category:
    name: SSRF
    shortName: Server Side Request Forgery
    displayName: Server Side Request Forgery (SSRF)
  subCategory: SSRF_ON_LOCALHOST
  severity: HIGH
  tags:
    - Business logic
    - OWASP top 10
    - HackerOne top 10
  references:
    - "https://github.com/OWASP/API-Security/blob/master/editions/2023/en/0xa7-server-side-request-forgery.md"
    - "https://www.akto.io/blog/how-to-prevent-server-side-request-forgery-ssrf-as-a-developer"
  cwe:
    - CWE-918
  cve:
    - CVE-2022-4725

attributes:
  nature: INTRUSIVE
  plan: FREE
  duration: FAST
compliance_standards:
  GDPR:
    - Article 32
    - Article 25
  HIPAA:
    - 45 CFR ยง 164.312(c)(1)
    - 45 CFR ยง 164.312(e)(1)
  SOC 2:
    - System and Communication Security
    - Secure Application Development Controls
  PCI DSS:
    - Requirement 6.5.9
    - Requirement 11.3
  ISO 27001:
    - A.12.6.1
    - A.14.2.5
  NIST 800-53:
    - SC-7
    - SI-10
  CSA CCM:
    - IVS-09
    - TVM-03
  CIS Controls:
    - IG1 Safeguard 9.4
    - IG2 Safeguard 18.3
  FedRAMP:
    - SC-7
    - SI-10
  NIST 800-171:
    - 3.1.20
    - 3.14.2
  FISMA:
    - SC-7
    - SI-10
  Cybersecurity Maturity Model Certification (CMMC):
    - SC.3.192
    - SI.2.216
api_selection_filters:
  method:
    neq: "OPTIONS"
  response_code:
    and:
      gte: 200
      lt: 205
  response_payload:
    not_contains:
      - "admin"
      - localhost
  or:
    - request_payload:
        for_one:
          value:
            contains_either:
              - http
          key:
            extract: url_key
    - query_param:
        for_one:
          value:
            contains_either:
              - http
          key:
            extract: url_key

execute:
  type: single
  requests:
    - req:
        - modify_query_param:
            url_key: http://localhost/admin
        - modify_body_param:
            url_key: http://localhost/admin

validate:
  response_code:
    gte: 200
    lt: 300
  response_payload:
    contains_either:
      - admin_menu
      - wp-json/wp
      - "Django administration"
      - "staff_member_required"
      - "Flask-Admin"
      - "flask_admin"
      - "ActiveAdmin"
      - "rails_admin"
      - "Express Admin"
      - "express_admin"
      - "laravel_admin"
      - wp-admin
      - loopback
      - HTTP/
      - "Server:"
      - "SSH-"
      - "mongod"
      - "handshake"
      - "Spring Boot Admin"
      - "Spring Security"
      - "@Controller"
      - "@RequestMapping"
      - "Spring Actuator"
      - "gorilla/mux"
      - "net/http"
      - "gin-gonic/gin"
    not_contains:
      - Access Denied
      - Error
      - SSRF
      - Blocked
      - WAF
      - Rejected
      - Security Exception
      - Invalid Request
      - Connection Refused
      - Failed
