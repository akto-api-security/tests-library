id: AUTH0_REDIRECT_URI_SSRF
info:
  name: "SSRF test for Redirect URI Parameter in Auth0 Authentication"
  description: "An SSRF (Server-Side Request Forgery) test for the Redirect URI parameter in Auth0 authentication evaluates how the system handles malicious inputs designed to force the server to make unauthorized requests. By manipulating the Redirect URI, attackers might trick the server into accessing internal resources or other unintended destinations, potentially exposing sensitive information or vulnerabilities. The test ensures that Auth0 properly validates and sanitizes these URIs to prevent exploitation."
  details: "In an SSRF test for the Redirect URI parameter in Auth0 authentication, testers try to exploit the redirect functionality by inputting URLs that point to internal or external resources. This can reveal whether Auth0 validation mechanisms prevent the server from making unintended requests or exposing sensitive endpoints. The goal is to ensure that the system correctly filters and handles redirect URIs to protect against unauthorized access or data leaks."
  impact: "A successful SSRF attack via the Redirect URI parameter in Auth0 could lead to unauthorized access to internal services or sensitive data, as the server may be tricked into making requests to restricted endpoints. This could compromise the security of internal systems or expose confidential information. Additionally, it might lead to further attacks if internal services are used to facilitate additional malicious activities."
  category:
    name: SSRF
    shortName: Server Side Request Forgery
    displayName: Server Side Request Forgery (SSRF)
  subCategory: AUTH0_REDIRECT_URI_SSRF
  severity: HIGH
  tags:
    - Business logic
    - OWASP top 10
    - HackerOne top 10
  references:
    - "https://github.com/OWASP/API-Security/blob/master/editions/2023/en/0xa7-server-side-request-forgery.md"
    - "https://www.akto.io/blog/how-to-prevent-server-side-request-forgery-ssrf-as-a-developer"
  cwe:
    - CWE-918
  cve:
    - CVE-2022-4725

api_selection_filters:
  method:
    eq: "GET"
  response_code:
    eq: 302
  response_payload:
    length:
      gt: 0
    not_contains:
      - Error
      - Internal Server 
      - Failed
      - Unauthorized
      - access denied
      - Forbidden
      - Method Not allowed
      - Gateway timeout
      - request timeout
      - server error
      - server busy
      - authentication error
      - authorization error
      - validation error
      - Permission Denied
      - invalid token
      - token expired
      - session expired
      - session timeout
      - unexpected error
      - unable to process request
      - bad request
      - service unavailable
      - account is locked
      - account is blocked
      - multiple failed attempts
  url:
    contains_all: 
      - authorize
      - auth0
  query_param:
    for_one:
      key:
        eq: redirect_uri
        extract: redirectURIKey
      value:
        regex: "\b((http|https|ftp)://[^\\s/$.?#].[^\\s]*)\b"
execute:
  type: single
  requests:
    - req:
        - send_ssrf_req:
            url: "https://test-services.akto.io/store_uuid/${random_uuid}"
        - modify_query_param:
            ${redirectURIKey}: "https://test-services.akto.io/${random_uuid}"
validate:
  response_code:
    eq: 302
  ssrf_url_hit: ${random_uuid}
  response_payload:
    length:
      gt: 0
    not_contains:
      - Error
      - Internal Server 
      - Failed
      - Unauthorized
      - access denied
      - Forbidden
      - Method Not allowed
      - Gateway timeout
      - request timeout
      - server error
      - server busy
      - authentication error
      - authorization error
      - validation error
      - Permission Denied
      - invalid token
      - token expired
      - session expired
      - session timeout
      - unexpected error
      - unable to process request
      - bad request
      - service unavailable
      - account is locked
      - account is blocked
      - multiple failed attempts