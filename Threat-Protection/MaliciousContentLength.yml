id: MaliciousContentLength
filter:
  request_headers:
    for_one:
      key:
        eq: content-length
      value:
        regex: "^(?![1-9]\\d{0,8}$).*"
info:
  name: "MaliciousContentLength"
  description: "MaliciousContentLength in runtime threat protection for APIs detects abnormal or excessively large content-length values in API requests. Attackers may manipulate the `Content-Length` header to exploit buffer overflows, trigger denial-of-service (DoS) attacks, or evade security controls. This protection helps mitigate threats by enforcing expected content size limits and blocking anomalous requests."
  details: "MaliciousContentLength protection monitors API requests for unusually large or inconsistent `Content-Length` values, which can indicate exploitation attempts. Attackers may use this technique for buffer overflows, web cache poisoning, or bypassing security controls. By enforcing expected size limits, this safeguard helps prevent denial-of-service (DoS) attacks and ensures API stability."
  impact: "If MaliciousContentLength attacks are not mitigated, APIs may suffer from buffer overflows, leading to crashes, data corruption, or remote code execution. Attackers can also exploit it for DoS attacks, causing service disruptions. Additionally, oversized payloads can bypass security filters, leading to potential data exfiltration or unauthorized access."
  category:
    name: "SM"
    displayName: "SM"
  subCategory: "SM"
  severity: MEDIUM

aggregation_rules:
  - rule:
      name: "Rule 1"
      condition:
        matchCount: 50 
        windowThreshold: 5
  - rule:
      name: "Rule 2"
      condition:
        matchCount: 100 
        windowThreshold: 10