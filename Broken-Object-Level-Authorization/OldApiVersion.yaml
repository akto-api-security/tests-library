id: OLD_VERSION_API_TEST
info:
  name: "Old API Version Test for detecting shadow APIs"
  description: "This test involves evaluating legacy API versions to identify and address any shadow APIs—those that are not documented or officially sanctioned but still in use. This test helps ensure that deprecated or unauthorized APIs do not pose security risks or cause inconsistencies within the system. By detecting and managing shadow APIs, organizations can maintain better control over their API landscape and improve overall security and compliance."
  details: "This test is a process where outdated API versions are examined to uncover shadow APIs—unauthorized or undocumented endpoints that may be in use within a system. This testing typically involves scanning for old API endpoints and analyzing their usage patterns to ensure they don't bypass current security measures or introduce vulnerabilities. By identifying these hidden APIs, organizations can take corrective actions to secure their systems and maintain accurate API documentation and control."
  impact: "The impact of this test is significant for system security and compliance. Detecting and managing shadow APIs helps prevent unauthorized access, reduce security risks, and ensure that outdated endpoints do not compromise the integrity of the system. By addressing these hidden APIs, organizations can enhance their security posture, improve data protection, and ensure that all APIs adhere to current policies and standards."
  category:
    name: IIM
    shortName: Improper Inventory Management
    displayName: Improper Inventory Management (IIM)
  subCategory: OLD_VERSION_API_TEST
  severity: CRITICAL
  tags:
    - Business logic
    - OWASP top 10
    - HackerOne top 10
  references:
    - https://owasp.org/API-Security/editions/2023/en/0xa9-improper-inventory-management/
    - https://www.akto.io/blog/3-new-ways-to-detect-improper-api-inventory-owasp-api9-2023
    - https://github.com/OWASP/API-Security/blob/master/editions/2023/en/0xa9-improper-inventory-management.md
  cwe:
    - CWE-1059
  cve:
    - CVE-2022-3203

attributes:
  nature: INTRUSIVE
  plan: FREE
  duration: FAST
compliance_standards:
  GDPR:
    - Article 32
    - Article 30
  HIPAA:
    - 45 CFR § 164.308(a)(1)(ii)(A)
    - 45 CFR § 164.312(b)
  SOC 2:
    - System Monitoring and Inventory Management
    - Logical and Physical Access Controls
  PCI DSS:
    - Requirement 1.1.6
    - Requirement 11.2
  ISO 27001:
    - A.8.1.1
    - A.8.1.2
  NIST 800-53:
    - CM-8
    - CA-7
  CSA CCM:
    - IVS-06
    - TVM-03
  CIS Controls:
    - IG1 Safeguard 1.4
    - IG2 Safeguard 2.3
  FedRAMP:
    - CM-8
    - CA-7
  NIST 800-171:
    - 3.4.1
    - 3.4.2
  FISMA:
    - CM-8
    - CA-7
  Cybersecurity Maturity Model Certification (CMMC):
    - AM.3.036
    - CM.2.068
api_selection_filters:
  response_code:
    gte: 200
    lt: 300
  method:
    neq: "OPTIONS"
  response_payload:
    length:
      gt: 0
    not_contains:
      - Error
      - Internal Server
      - Failed
      - Unauthorized
      - access denied
      - Forbidden
      - Method Not allowed
      - Gateway timeout
      - request timeout
      - server error
      - server busy
      - authentication error
      - authorization error
      - validation error
      - Permission Denied
      - invalid token
      - token expired
      - session expired
      - session timeout
      - unexpected error
      - unable to process request
      - bad request
      - service unavailable
      - account is locked
      - account is blocked
      - multiple failed attempts
  url:
    regex: v([2-9]\d*|\d{2,})/
execute:
  type: single
  requests:
    - req:
        - modify_url:
            regex_replace:
              regex: v([2-9]\d*|\d{2,})/
              replace_with: v1/
validate:
  response_code:
    gte: 200
    lt: 300
  response_payload:
    length:
      gt: 0
    not_contains:
      - Error
      - Internal Server
      - Failed
      - Unauthorized
      - access denied
      - Forbidden
      - Method Not allowed
      - Gateway timeout
      - request timeout
      - server error
      - server busy
      - authentication error
      - authorization error
      - validation error
      - Permission Denied
      - invalid token
      - token expired
      - session expired
      - session timeout
      - unexpected error
      - unable to process request
      - bad request
      - service unavailable
      - account is locked
      - account is blocked
      - multiple failed attempts
  url:
    endpoint_in_traffic_context: false

strategy:
  insertVulnApi: true
