id: VEM_INVALID_UUID
info:
  name: Invalid UUID in Request Body - Descriptive Error Response
  description: "Verifies that APIs return a structured, non-leaky error when a UUID in the request body is replaced with an invalid UUID (e.g. 422 with errorCode and message containing 'Invalid UUID')."
  details: >
    "The test replaces UUIDs in the request body with an invalid UUID (xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx) and validates that the API responds with a proper error format: HTTP 422, errorCode (e.g. ERROR_External_Error), and a message indicating invalid UUID (e.g. [author Invalid UUID]) without exposing stack traces or implementation details."
  impact: "This information can be used to facilitate more sophisticated attacks on your application"
  category:
    name: VEM
    shortName: Verbose Error Messages
    displayName: Verbose Error Messages (VEM)
  subCategory: VEM_INVALID_UUID
  severity: MEDIUM
  tags:
    - Business logic
    - OWASP top 10
    - HackerOne top 10
  references:
    - "https://owasp.org/www-community/Improper_Error_Handling"
  cwe:
    - CWE-209
    - CWE-200
  cve:
    - CVE-2020-11883
    - CVE-2020-15652

attributes:
  nature: INTRUSIVE
  plan: STANDARD
  duration: FAST

api_selection_filters:
  method:
    contains_either:
      - "PUT"
      - "POST"
      - "PATCH"
  response_code:
    gte: 200
    lt: 300
  response_payload:
    not_contains:
      - column
      - row
      - line
      - function
      - class
      - stacktrace
    length:
      gt: 0
  request_headers:
    not_contains:
      - "x-envoy"
      - "api-gateway"
      - "correlation-id"
      - "documentation"
  request_payload:
    not_contains:
      - "x-envoy"
      - "api-gateway"
      - "correlation-id"
      - "documentation"
    regex: "[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}"

execute:
  type: single
  requests:
    - req:
        - replace_body:
            regex_replace:
              regex: "[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}"
              replace_with: "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"

validate:
  response_code:
    gte: 400
  response_payload:
    contains_either:
      - "x-envoy"
      - "api-gateway"
      - "correlation-id"
      - "documentation"
