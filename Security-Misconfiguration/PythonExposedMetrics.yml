id: PYTHON_EXPOSED_METRICS
info:
  name: "Python Exposed Metrics Detection Test"
  description: "Python Exposed Metrics Detection Test involves identifying if a Python application is exposing sensitive metrics or performance data publicly. These metrics, often related to system health, resource usage, or application performance, could be unintentionally accessible through endpoints like `/metrics`. Exposed metrics can provide attackers with valuable information about the application's inner workings, making it a potential attack vector. Detecting and securing such endpoints is crucial to prevent unauthorized access to sensitive system details."
  details: "The Python Exposed Metrics Detection Test checks for publicly exposed endpoints that reveal internal application or system metrics, typically provided by monitoring tools like Prometheus. These metrics often include details about CPU usage, memory, request counts, and error rates. If not properly secured, attackers can leverage this information to gain insights into potential vulnerabilities, system weaknesses, or performance bottlenecks. The test involves scanning for common `/metrics` endpoints or similar paths and ensuring they are protected with proper access controls or authentication."
  impact: "The impact of Python Exposed Metrics can be significant, as publicly accessible performance data might reveal sensitive details about the applicationâ€™s infrastructure, resource usage, or potential weaknesses. Attackers could use this information to identify attack vectors, such as overloaded services or misconfigured components, and plan targeted exploits. Exposing such metrics increases the risk of data breaches, denial-of-service attacks, or system compromise. Securing these endpoints is essential to prevent attackers from gaining valuable intelligence."
  category:
    name: SM
    shortName: Misconfiguration
    displayName: Security Misconfiguration (SM)
  subCategory: PYTHON_EXPOSED_METRICS
  severity: LOW
  references:
    - "https://github.com/OWASP/API-Security/blob/master/editions/2023/en/0xa8-security-misconfiguration.md"
  cwe:
    - CWE-200
    - CWE-213
  cve:
    - CVE-2018-10245


settings:
  nature: NON-INTRUSIVE
  plan: PRO
  duration: FAST
api_selection_filters:
  method:
    neq: "OPTIONS"
  response_code:
    gte: 200
    lt: 300
  response_payload:
    length:
      gt: 0
wordLists:
  paths:
    - '/metrics'
execute:
  type: single
  requests:
    - req:
        - modify_url: "${paths}"
        - modify_method: GET
        - replace_body: '{}'
validate:
  response_code:
    eq: 200
  response_payload:
    length:
      gt: 0
    contains_either:
      - "python_gc_objects_collected_total"
      - "python_info"
strategy:
  run_once: /
