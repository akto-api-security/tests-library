id: KEYCLOAK_OPEN_REDIRECT
info:
  name: "KeyCloak Open Redirect Vulnerability Test"
  description: "The Keycloak Open Redirect Vulnerability Test checks for open redirect flaws in Keycloak, an open-source identity and access management solution. An open redirect occurs when a web application improperly allows user-controlled input to specify the destination of a redirect, enabling attackers to redirect users to malicious websites. This can lead to phishing attacks, where users are tricked into visiting fraudulent sites that appear legitimate. To mitigate this risk, input validation and secure redirect handling should be implemented, ensuring that only trusted URLs are used for redirects."
  details: "The Keycloak Open Redirect Vulnerability Test identifies whether Keycloak improperly handles URL redirects, allowing attackers to manipulate redirection behavior by injecting malicious URLs. In this vulnerability, attackers could craft a request with a manipulated redirect URL, leading users to phishing sites or malicious web pages. This can be exploited to steal user credentials, perform social engineering attacks, or spread malware. Proper URL validation and restriction of allowed redirect destinations are essential to prevent this type of attack in Keycloak configurations."
  impact: "The impact of a Keycloak Open Redirect Vulnerability can be significant, as it allows attackers to redirect users to malicious websites without their knowledge. This can lead to phishing attacks, where users are tricked into revealing sensitive information like login credentials or personal data. Additionally, it can expose users to malware or other social engineering threats. To mitigate this risk, strict URL validation and limiting redirect destinations to trusted sources are essential in preventing such exploitation."
  category:
    name: SM
    shortName: Misconfiguration
    displayName: Security Misconfiguration (SM)
  subCategory: KEYCLOAK_OPEN_REDIRECT
  severity: LOW
  references:
    - "https://github.com/OWASP/API-Security/blob/master/editions/2023/en/0xa8-security-misconfiguration.md"
  cwe:
    - CWE-200
    - CWE-213
  cve:
    - CVE-2018-10245


settings:
  nature: INTRUSIVE
api_selection_filters:
  method:
    neq: "OPTIONS"
  response_code:
    gte: 200
    lt: 300
  response_payload:
    length:
      gt: 0
wordLists:
  paths:
    - '/realms/master/protocol/openid-connect/auth'
  clients:
    - security-admin-console
    - master-realm
    - broker
    - admin-cli
    - account
    - account-console
  redirect_host:
    - "http://localhost"
    - "http://127.0.0.1"
    - "https://localhost"
    - "https://127.0.0.1"
    - "http://[::]"
    - "https://[::]"
execute:
  type: single
  requests:
    - req:
        - modify_url: "${paths}"
        - modify_method: GET
        - replace_body: '{}'
        - add_query_param:
            client_id: ${clients}
        - add_query_param:
            redirect_uri: "${redirect_host}:80@akto.io"
validate:
  response_code:
    eq: 302
  response_payload:
    length:
      gt: 0
  response_headers:
    for_one:
      key:
        eq: location
      value:
        contains_either:
          - "localhost"
          - "127.0.0.1"
          - "akto.io"
strategy:
  run_once: /
