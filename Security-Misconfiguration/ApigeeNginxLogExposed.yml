id: APIGEE_NGINX_LOG_EXPOSED
info:
  name: Apigee Nginx Log Exposed
  description: >
    "Nginx log exposure occurs when server log files are accessible through web requests. This can lead to information disclosure of sensitive data such as internal server errors, file paths, IP addresses, and other diagnostic messages that should not be accessible to the public."
  details: >
    "Logs like Nginx's `error.log` or `access.log` may contain sensitive information such as request details, server configurations, file paths, and internal errors. If these log files are accessible via the web, attackers can exploit this information to plan more targeted attacks or identify vulnerabilities."
  impact: >
    "Exposure of log files can result in sensitive data leakage, such as IP addresses, request headers, file paths, and stack traces. This information can be used to exploit vulnerabilities in the web application, compromise user privacy, or lead to further attacks on the server infrastructure."

  category:
    name: SM
    shortName: Misconfiguration
    displayName: Security Misconfiguration (SM)
  subCategory: APIGEE_NGINX_LOG_EXPOSED
  severity: LOW
  references:
    - https://docs.apigee.com/api-platform/troubleshoot/debugging/enable-nginx-debug-logs-on-routers
    - "https://github.com/OWASP/API-Security/blob/master/editions/2023/en/0xa8-security-misconfiguration.md"
  cwe:
    - CWE-16
    - CWE-200
  cve:
    - CVE-2020-11959

attributes:
  nature: NON_INTRUSIVE
  plan: STANDARD
  duration: FAST


api_selection_filters:
  method:
    neq: "OPTIONS"
  response_code:
    gte: 200
    lt: 300
  url:
    regex: ".*apigee.*nginx.*log"

execute:
  type: single
  requests:
    - req:
        - remove_auth_header: true
        - replace_body: "{}"

validate:
  response_code:
    eq: 200
  response_payload:
    length:
      gt: 0
    contains_either:
      - proxy_host
      - upstream_status
      - request_time
      - sent_http_x_apigee
      - apiproduct_name
      - developer_email
      - cache_status
      - target_response_time
      - api_proxy_name
      - oauth_access_token
      - jwt_claims
      - quota_exceeded
      - fault_code
      - apikey_verification_status
      - flow_variable
    not_contains:
      - Error
      - Internal Server
      - Failed
      - Unauthorized
      - access denied
      - Forbidden
      - Method Not allowed
      - Gateway timeout
      - request timeout
      - server error
      - server busy
      - authentication error
      - authorization error
      - validation error
      - Permission Denied
      - invalid token
      - token expired
      - session expired
      - session timeout
      - unexpected error
      - unable to process request
      - bad request
      - service unavailable
      - account is locked
      - account is blocked
      - multiple failed attempts
      - Attention Required!
      - CloudFlare
      - "Sorry, you have been blocked"

strategy:
  run_once: /
