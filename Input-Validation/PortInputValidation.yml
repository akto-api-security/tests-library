id: PORT_INPUT_VALIDATION
info:
  name: "Port Input Validation"
  description: >
    This test evaluates the application's handling of port numbers in URL inputs to ensure that only valid port values are accepted and processed correctly.
  details: >
    The test involves sending requests where URL parameters containing HTTP endpoints are modified to include various port numbers (including common service ports like 22, 80, 443, 3000, 8080, etc.). The objective is to determine if the application properly validates port inputs and handles different port numbers appropriately. The test checks whether the application accepts requests with manipulated port numbers and responds with success codes, which may indicate insufficient validation of port inputs in URLs.
  impact: >
    Insufficient validation of port numbers in URL inputs can lead to unexpected application behavior, security misconfigurations, or potential exploitation where attackers might probe internal network services or bypass intended restrictions. Proper validation ensures that only expected and safe port numbers are processed by the application.
  category:
    name: INPUT
    shortName: Input Validation
    displayName: Input Validation (INPUT)
  subCategory: PORT_INPUT_VALIDATION
  severity: MEDIUM
  tags:
    - Business logic
    - OWASP top 10
    - HackerOne top 10
  references:
    - "https://cheatsheetseries.owasp.org/cheatsheets/Input_Validation_Cheat_Sheet.html"
    - "https://owasp.org/www-project-developer-guide/draft/design/web_app_checklist/validate_inputs/"
  cwe:
    - CWE-20
  cve:
    - CVE-2018-20679
    - CVE-2019-14271

attributes:
  nature: INTRUSIVE
  plan: STANDARD
  duration: FAST

api_selection_filters:
  method:
    neq: "OPTIONS"
  response_payload:
    not_contains:
      - "rejected"
      - "refused"
      - "timeout"
      - "MongoDB"
  or:
    - request_payload:
        for_one:
          value:
            contains_either:
              - http
          key:
            extract: url_key
    - query_param:
        for_one:
          value:
            contains_either:
              - http
          key:
            extract: url_key

wordLists:
  filePaths:
    - http://localhost:22
    - http://localhost:80
    - http://localhost:443
    - http://localhost:8443
    - http://localhost:3000
    - http://localhost:5000
    - http://localhost:8000
    - http://localhost:8080
    - http://localhost:27017

execute:
  type: single
  requests:
    - req:
        - modify_query_param:
            url_key: ${filePaths}
        - modify_body_param:
            url_key: ${filePaths}

validate:
  response_code:
    gte: 200
    lt: 300
  response_payload:
    or: 
    - regex:
        - "(?i)rejected"
        - "(?i)refused"
        - "(?i)timeout"
        - "MongoDB"
    - length:
      - gt: 0
      percentage_match_schema:
      - gte: 60
      percentage_match:
      - gt: 50
    not_contains:
      - Access Denied
      - Error
      - SSRF
      - Blocked
      - WAF
      - Rejected
      - Security Exception
      - Invalid Request
      - Connection Refused
      - Failed
