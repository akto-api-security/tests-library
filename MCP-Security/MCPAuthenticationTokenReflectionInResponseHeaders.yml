---
id: AUTHENTICATION_TOKEN_REFLECTION_IN_HEADERS_MCP
info:
  name: Authentication Token Reflection in Response Headers (MCP)
  description: |
    This test verifies whether the access token provided in the Authorization header is echoed back in the server's response headers.
  details: |
    Reflecting sensitive tokens in response headers poses a serious risk of credential leakage via logs, proxies, caches, or browser access.
    This test modifies the access token with a unique marker and inspects response headers for reflection.
  impact: |
    Tokens exposed in response headers can be intercepted or logged unintentionally, increasing the risk of unauthorized access and session hijacking.
  category:
    name: MCP_AUTH
    shortName: MCP_AUTH
    displayName: Model Context Protocol (MCP) Security - Broken Authentication
  subCategory: AUTHENTICATION_TOKEN_REFLECTION_IN_HEADERS_MCP
  severity: HIGH
  tags:
  - Authentication
  - Token leakage
  - Business logic
  - OWASP top 10
  references:
  - https://cheatsheetseries.owasp.org/cheatsheets/Authentication_Cheat_Sheet.html
  - https://owasp.org/www-community/attacks/Information_exposure_through_response_headers
  cwe:
  - CWE-200
  cve:
  - CVE-2023-1644
attributes:
  nature: INTRUSIVE
  plan: PRO
  duration: FAST
api_selection_filters:
  response_code:
    gte: 200
    lt: 300
  method:
    eq: POST
  request_payload:
    contains_all:
    - jsonrpc
    - method
    - params
  request_headers:
    for_one:
      key:
        contains_either: "$magic From the request headers, find the key that holds the authorization token. This will typically contain access credentials. Return only the header key name."
        extract: authHeaderKey
      value:
        extract: authHeaderVal
execute:
  type: single
  requests:
  - req: []
validate:
  response_headers:
    contains_either: "$magic Check whether the response headers contains any authentication token value that was passed in the request header (the heder value: ${authHeaderVal}). If there is no exact token matching, then return just empty braces. Else return a list of words with the actual token found in the response header only."
