id: GRAPHQL_DOS_MULTI_VARIABLE_KEYS
info:
  name: "Denial of Service Test on GraphQL APIs with multiple keys in a single variable object"
  description: "In this test, GraphQL queries are designed to include variable objects with an unusually high number of keys in a single request. This examination aims to evaluate the API's capability to handle intricate variable structures, pinpointing potential vulnerabilities that might result in performance deterioration or server instability. By simulating these scenarios, testers can identify weaknesses and guarantee that the API maintains its availability and reliability even when processing diverse input formats."
  details: "In this test, GraphQL queries are formulated to feature a variable object with an abundance of keys within a single request, challenging the API's capacity to manage complex variable structures. Evaluating how the API handles such intricacies helps uncover vulnerabilities that could lead to performance issues or server instability. Detecting and addressing these weaknesses ensures the GraphQL API remains resilient and capable of sustaining optimal performance under various input conditions."
  impact: "The impact of this test can be significant, potentially leading to increased server load, resource exhaustion, or service disruptions. By overwhelming the API with queries containing numerous keys in a single variable object, attackers can cause performance degradation or even service downtime. Addressing this vulnerability is crucial to maintaining the stability, reliability, and availability of the GraphQL API under high loads and diverse input conditions."
  category:
    name: RL
    shortName: Lack of Resources & Rate Limiting
    displayName: Lack of Resources & Rate Limiting (RL)
  subCategory: GRAPHQL_DOS_MULTI_VARIABLE_KEYS
  severity: HIGH
  tags:
    - Business logic
    - OWASP top 10
    - HackerOne top 10
  references:
    - "https://github.com/OWASP/API-Security/blob/master/editions/2023/en/0xa4-unrestricted-resource-consumption.md"
  cwe:
    - CWE-400
  cve:
    - CVE-2023-4647
    - CVE-2023-38254

attributes:
  nature: INTRUSIVE
  plan: PRO
  duration: SLOW


api_selection_filters:
  method:
    neq: "OPTIONS"
  url:
    regex: graphql
  response_payload:
    length:
      gt: 0
    not_contains:
      - error
      - issue
      - UserNotAuthorizedError
      - INTERNAL_SERVER_ERROR
      - "GRAPHQL_VALIDATION_FAILED"
      - "graphQL syntax error"
      - "Syntax Error: Expected Name, found <EOF>."
      - "GRAPHQL_PARSE_FAILED"
      - "Bad Request"

execute:
  type: multiple
  requests:
    - req:
        - add_header:
            dummyKey: dummyVal
        - validate:
            response_payload:
              percentage_match:
                gte: 80
        - success: x2
        - failure: exit
    - req:
        - replace_body: '{"variables": {"testhgj":"testData","test1sm":"testData","testaty":"testData","test3re":"testData","test4g":"testData","test5r":"testData","test6y":"testData","test7o":"testData","test8l":"testData","test9ee":"testData10","test11e":"testData","test12ee":"testData","test13ee":"testData","test14ee":"testData","test15ee":"testData","test16ee":"testData","test17ee":"testData","test18ee":"testData","test19ee":"testData","testa0ee":"testData","testa1ee":"testData22","test1eef":"testData23","testa4ee":"testData","testa5ee":"testData","testa6ee":"testData","testa7rt":"testData","testa8ee":"testData","testa9ee":"testData","test30ee":"testData","test31ee":"testData32","test33ee":"testData","test34ee":"testData","test35ee":"testData","test36ee":"testData","test37ee":"testData","test38ee":"testData","test39ee":"testData","test40ee":"testData","test41ee":"testData","test42ee":"testData","test":"testData","test1ee":"testData","testa":"testData","test3":"testData","test4":"testData","test5":"testData","test6":"testData","test7":"testData","test8":"testData","test9":"testData10","test11":"testData","test12":"testData","test13":"testData","test14":"testData","test15":"testData","test16":"testData","test17":"testData","test18":"testData","test19":"testData","testa0":"testData","testa1":"testData22","test1":"testData23","testa4":"testData","testa5":"testData","testa6":"testData","testa7":"testData","testa8":"testData","testa9":"testData","test30":"testData","test31":"testData32","test33":"testData","test34":"testData","test35":"testData","test36":"testData","test37":"testData","test38":"testData","test39":"testData","test40":"testData","test41":"testData","test42":"testData","testgh":"testghData","testgh1h":"testghData","testgha":"testghData","testgh3":"testghData","testgh4":"testghData","testgh5":"testghData","testgh6":"testghData","testgh7":"testghData","testgh8":"testghData","testgh9":"testghData10","testgh11":"testghData","testgh12":"testghData","testgh13":"testghData","testgh14":"testghData","testgh15":"testghData","testgh16":"testghData","testgh17":"testghData","testgh18":"testghData","testgh19":"testghData","testgha0":"testghData","testgha1":"testghData22","testgh1":"testghData23","testgha4":"testghData","testgha5":"testghData","testgha6":"testghData","testgha7":"testghData","testgha8":"testghData","testgha9":"testghData","testgh30":"testghData","testgh31":"testghData32","testgh33":"testghData","testgh34":"testghData","testgh35":"testghData","testgh36":"testghData","testgh37":"testghData","testgh38":"testghData","testgh39":"testghData","testgh40":"testghData","testgh41":"testghData","testgh42":"testghData","testiut":"testiuData","testiu1t":"testiuData","testiuat":"testiuData","testiu3t":"testiuData","testiu4t":"testiuData","testiu5b":"testiuData","testiu6z":"testiuData","testiu7b":"testiuData","testiu8b":"testiuData","testiu9l":"testiuData10","testiu11z":"testiuData","testiu12c":"testiuData","testiu13m":"testiuData","testiu14l":"testiuData","testiu15z":"testiuData","testiu16c":"testiuData","testiu17m":"testiuData","testiu18l":"testiuData","testiu19z":"testiuData","testiua0c":"testiuData","testiua1m":"testiuData22","testiu1v":"testiuData23","testiua4z":"testiuData","testiua5c":"testiuData","testiua6e":"testiuData","testiua7v":"testiuData","testiua8f":"testiuData","testiua9c":"testiuData","testiu30e":"testiuData","testiu31v":"testiuData32","testiu33f":"testiuData","testiu34c":"testiuData","testiu35e":"testiuData","testiu36v":"testiuData","testiu37f":"testiuData","testiu38c":"testiuData","testiu39e":"testiuData","testiu40v":"testiuData","testiu41f":"testiuData","testiu42c":"testiuData","testiu":"testiuData","testiu1jkl":"testiuData","testiua":"testiuData","testiu3":"testiuData","testiu4":"testiuData","testiu5":"testiuData","testiu6":"testiuData","testiu7":"testiuData","testiu8":"testiuData","testiu9":"testiuData10","testiu11":"testiuData","testiu12":"testiuData","testiu13":"testiuData","testiu14":"testiuData","testiu15":"testiuData","testiu16":"testiuData","testiu17":"testiuData","testiu18":"testiuData","testiu19":"testiuData","testiua0":"testiuData","testiua1":"testiuData22","testiu1":"testiuData23","testiua4":"testiuData","testiua5":"testiuData","testiua6":"testiuData","testiua7":"testiuData","testiua8":"testiuData","testiua9":"testiuData","testiu30":"testiuData","testiu31":"testiuData32","testiu33":"testiuData","testiu34":"testiuData","testiu35":"testiuData","testiu36":"testiuData","testiu37":"testiuData","testiu38":"testiuData","testiu39":"testiuData","testiu40":"testiuData","testiu41":"testiuData","testiu42":"testiuData","testiugh":"testiughData","testiugh1":"testiughData","testiugha":"testiughData","testiugh3":"testiughData","testiugh4":"testiughData","testiugh5":"testiughData","testiugh6":"testiughData","testiugh7":"testiughData","testiugh8":"testiughData","testiugh9":"testiughData10","testiugh11":"testiughData","testiugh12":"testiughData","testiugh13":"testiughData","testiugh14":"testiughData","testiugh15":"testiughData","testiugh16":"testiughData","testiugh17":"testiughData","testiugh18":"testiughData","testiugh19":"testiughData","testiugha0":"testiughData","testiugha1":"testiughData22","testiugh1er":"testiughData23","testiugha4":"testiughData","testiugha5":"testiughData","testiugha6":"testiughData","testiugha7":"testiughData","testiugha8":"testiughData","testiugha9":"testiughData","testiugh30":"testiughData","testiugh31":"testiughData32","testiugh33":"testiughData","testiugh34":"testiughData","testiugh35":"testiughData","testiugh36":"testiughData","testiugh37":"testiughData","testiugh38":"testiughData","testiugh39":"testiughData","testiugh40":"testiughData","testiugh41":"testiughData","testiugh42":"testiughData","testyuee":"testyuData","testyu1ee":"testyuData","testyuaee":"testyuData","testyu3ee":"testyuData","testyu4ee":"testyuData","testyu5eee":"testyuData","testyu6ee":"testyuData","testyu7ee":"testyuData","testyu8y":"testyuData","testyu9eee":"testyuData10","testyu11eee":"testyuData","testyu1e2":"testyuData","testyu13ee":"testyuData","testyu14ee":"testyuData","testyu15y":"testyuData","testyu16y":"testyuData","testyu17y":"testyuData","testyu18y":"testyuData","testyu19y":"testyuData","testyua0y":"testyuData","testyua1y":"testyuData22","testyu1y":"testyuData23","testyua4y":"testyuData","testyua5y":"testyuData","testyua6y":"testyuData","testyua7y":"testyuData","testyua8y":"testyuData","testyua9y":"testyuData","testyu30y":"testyuData","testyu31y":"testyuData32","testyu33y":"testyuData","testyu34y":"testyuData","testyu35y":"testyuData","testyu36y":"testyuData","testyu37y":"testyuData","testyu38y":"testyuData","testyu39r":"testyuData","testyu40r":"testyuData","testyu41r":"testyuData","testyu42r":"testyuData","testyu":"testyuData","testyu1u":"testyuData","testyua":"testyuData","testyu3":"testyuData","testyu4":"testyuData","testyu5":"testyuData","testyu6":"testyuData","testyu7":"testyuData","testyu8":"testyuData","testyu9":"testyuData10","testyu11":"testyuData","testyu12":"testyuData","testyu13":"testyuData","testyu14":"testyuData","testyu15":"testyuData","testyu16":"testyuData","testyu17":"testyuData","testyu18":"testyuData","testyu19":"testyuData","testyua0":"testyuData","testyua1":"testyuData22","testyu1":"testyuData23","testyua4":"testyuData","testyua5":"testyuData","testyua6":"testyuData","testyua7":"testyuData","testyua8":"testyuData","testyua9":"testyuData","testyu30":"testyuData","testyu31":"testyuData32","testyu33":"testyuData","testyu34":"testyuData","testyu35":"testyuData","testyu36":"testyuData","testyu37":"testyuData","testyu38":"testyuData","testyu39":"testyuData","testyu40":"testyuData","testyu41":"testyuData","testyu42":"testyuData","testyugh":"testyughData","testyugh1er":"testyughData","testyugha":"testyughData","testyugh3":"testyughData","testyugh4":"testyughData","testyugh5":"testyughData","testyugh6":"testyughData","testyugh7":"testyughData","testyugh8":"testyughData","testyugh9":"testyughData10","testyugh11":"testyughData","testyugh12":"testyughData","testyugh13":"testyughData","testyugh14":"testyughData","testyugh15":"testyughData","testyugh16":"testyughData","testyugh17":"testyughData","testyugh18":"testyughData","testyugh19":"testyughData","testyugha0":"testyughData","testyugha1":"testyughData22","testyugh1":"testyughData23","testyugha4":"testyughData","testyugha5":"testyughData","testyugha6":"testyughData","testyugha7":"testyughData","testyugha8":"testyughData","testyugha9":"testyughData","testyugh30":"testyughData","testyugh31":"testyughData32","testyugh33":"testyughData","testyugh34":"testyughData","testyugh35":"testyughData","testyugh36":"testyughData","testyugh37":"testyughData","testyugh38":"testyughData","testyugh39":"testyughData","testyugh40":"testyughData","testyugh41":"testyughData","testyugh42":"testyughData","testyuiuio":"testyuiuData","testyuiu1op":"testyuiuData","testyuiuaww":"testyuiuData","testyuiu3ww":"testyuiuData","testyuiu4ww":"testyuiuData","testyuiu5ww":"testyuiuData","testyuiu6ww":"testyuiuData","testyuiu7ww":"testyuiuData","testyuiu8ww":"testyuiuData","testyuiu9ww":"testyuiuData10","testyuiu11ww":"testyuiuData","testyuiu1w2":"testyuiuData","testyuiu13ww":"testyuiuData","testyuiu14ww":"testyuiuData","testyuiu15qq":"testyuiuData","testyuiu16qq":"testyuiuData","testyuiu17qq":"testyuiuData","testyuiu18qq":"testyuiuData","testyuiu19qq":"testyuiuData","testyuiua0qq":"testyuiuData","testyuiua1qq":"testyuiuData22","testyuiu1qq":"testyuiuData23","testyuiua4qq":"testyuiuData","testyuiua5qq":"testyuiuData","testyuiua6qq":"testyuiuData","testyuiua7qq":"testyuiuData","testyuiua8qq":"testyuiuData","testyuiua9qq":"testyuiuData","testyuiu30qq":"testyuiuData","testyuiu31qq":"testyuiuData32","testyuiu33qq":"testyuiuData","testyuiu34qq":"testyuiuData","testyuiu35ss":"testyuiuData","testyuiu36ss":"testyuiuData","testyuiu37qq":"testyuiuData","testyuiu38ss":"testyuiuData","testyuiu39ss":"testyuiuData","testyuiu40ss":"testyuiuData","testyuiu41ss":"testyuiuData","testyuiu42ss":"testyuiuData","testyuiu":"testyuiuData","testyuiu1ss":"testyuiuData","testyuiua":"testyuiuData","testyuiu3":"testyuiuData","testyuiu4":"testyuiuData","testyuiu5":"testyuiuData","testyuiu6":"testyuiuData","testyuiu7":"testyuiuData","testyuiu8":"testyuiuData","testyuiu9":"testyuiuData10","testyuiu11":"testyuiuData","testyuiu12":"testyuiuData","testyuiu13":"testyuiuData","testyuiu14":"testyuiuData","testyuiu15":"testyuiuData","testyuiu16":"testyuiuData","testyuiu17":"testyuiuData","testyuiu18":"testyuiuData","testyuiu19":"testyuiuData","testyuiua0":"testyuiuData","testyuiua1":"testyuiuData22","testyuiu1":"testyuiuData23","testyuiua4":"testyuiuData","testyuiua5":"testyuiuData","testyuiua6":"testyuiuData","testyuiua7":"testyuiuData","testyuiua8":"testyuiuData","testyuiua9":"testyuiuData","testyuiu30":"testyuiuData","testyuiu31":"testyuiuData32","testyuiu33":"testyuiuData","testyuiu34":"testyuiuData","testyuiu35":"testyuiuData","testyuiu36":"testyuiuData","testyuiu37":"testyuiuData","testyuiu38":"testyuiuData","testyuiu39":"testyuiuData","testyuiu40":"testyuiuData","testyuiu41":"testyuiuData","testyuiu42":"testyuiuData","testyuiugh":"testyuiughData","testyuiugh1gg":"testyuiughData","testyuiugha":"testyuiughData","testyuiugh3":"testyuiughData","testyuiugh4":"testyuiughData","testyuiugh5":"testyuiughData","testyuiugh6":"testyuiughData","testyuiugh7":"testyuiughData","testyuiugh8":"testyuiughData","testyuiugh9":"testyuiughData10","testyuiugh11":"testyuiughData","testyuiugh12":"testyuiughData","testyuiugh13":"testyuiughData","testyuiugh14":"testyuiughData","testyuiugh15":"testyuiughData","testyuiugh16":"testyuiughData","testyuiugh17":"testyuiughData","testyuiugh18":"testyuiughData","testyuiugh19":"testyuiughData","testyuiugha0":"testyuiughData","testyuiugha1":"testyuiughData22","testyuiugh1":"testyuiughData23","testyuiugha4":"testyuiughData","testyuiugha5":"testyuiughData","testyuiugha6":"testyuiughData","testyuiugha7":"testyuiughData","testyuiugha8":"testyuiughData","testyuiugha9":"testyuiughData","testyuiugh30":"testyuiughData","testyuiugh31":"testyuiughData32","testyuiugh33":"testyuiughData","testyuiugh34":"testyuiughData","testyuiugh35":"testyuiughData","testyuiugh36":"testyuiughData","testyuiugh37":"testyuiughData","testyuiugh38":"testyuiughData","testyuiugh39":"testyuiughData","testyuiugh40":"testyuiughData","testyuiugh41":"testyuiughData","testyuiugh42":"testyuiughData"},"query":
            "query getDummy{__typename}"}'
        - validate:
            response_code:
              gt: 505

validate:
  and:
    - compare_greater:
        - ${x2.response.stats.median_response_time}
        - 5001
    - compare_greater:
        - ${x2.response.stats.median_response_time}
        - ${x1.response.stats.median_response_time} * 5
strategy:
  run_once: /
